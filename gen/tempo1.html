<!DOCTYPE html>
<html>
<head>
    <title>Juzzle Generator - Clean Boolean Operations</title>
    <style>
        body { margin: 0; padding: 20px; background: #111; font-family: monospace; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #0af; text-align: center; margin: 20px 0; }
        .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
        .controls {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #222;
            border-radius: 10px;
        }
        button {
            padding: 12px 24px;
            margin: 8px;
            background: #0a5;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #0c6; }
        #grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .piece-card {
            background: #222;
            padding: 15px;
            border-radius: 10px;
        }
        .piece-header {
            margin-bottom: 15px;
            text-align: center;
        }
        .piece-id { color: #0af; font-weight: bold; font-size: 18px; }
        .piece-svg {
            width: 100%;
            height: 300px;
            background: #181818;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§© Juzzle Generator - Clean Masks</h1>
        <div class="subtitle">No outlines, just clean boolean shapes</div>
        
        <div class="controls">
            <button onclick="generatePieces(16)">Generate 16 Pieces</button>
            <button onclick="generatePieces(24)">Generate 24 Pieces</button>
            <button onclick="exportGrid()">Export Grid</button>
        </div>
        
        <div id="grid"></div>
    </div>

    <script>
        // Template coordinates
        const TEMPLATE = {
            square: { x: 373.83, y: 381.35, width: 355.32, height: 355.32 },
            sides: {
                left: [
                    { cx: 331.55, cy: 559.01, type: 'outer' },
                    { cx: 414.33, cy: 559.01, type: 'inner' }
                ],
                right: [
                    { cx: 688.86, cy: 559.01, type: 'inner' },
                    { cx: 771.64, cy: 559.01, type: 'outer' }
                ],
                top: [
                    { cx: 551.49, cy: 336.84, type: 'outer' },
                    { cx: 551.49, cy: 419.63, type: 'inner' }
                ],
                bottom: [
                    { cx: 551.49, cy: 694.15, type: 'inner' },
                    { cx: 551.49, cy: 776.94, type: 'outer' }
                ]
            },
            radius: 64.65
        };

        class CleanGenerator {
            constructor() {
                this.normalizeCoordinates();
            }
            
            normalizeCoordinates() {
                this.square = { x: 0, y: 0, width: TEMPLATE.square.width, height: TEMPLATE.square.height };
                
                this.sides = {};
                for (const [sideName, circles] of Object.entries(TEMPLATE.sides)) {
                    this.sides[sideName] = circles.map(circle => ({
                        cx: circle.cx - TEMPLATE.square.x,
                        cy: circle.cy - TEMPLATE.square.y,
                        type: circle.type,
                        original: circle
                    }));
                }
            }
            
            generatePiece() {
                return {
                    left: Math.random() > 0.5 ? 0 : 1,
                    right: Math.random() > 0.5 ? 0 : 1,
                    top: Math.random() > 0.5 ? 0 : 1,
                    bottom: Math.random() > 0.5 ? 0 : 1
                };
            }
            
            // Create clean piece with masks - NO OUTLINES
            createPieceSVG(piece, id, color) {
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, 'svg');
                svg.setAttribute('viewBox', '0 0 355.32 355.32');
                svg.setAttribute('width', '300');
                svg.setAttribute('height', '300');
                
                // Create mask for boolean operations
                const defs = document.createElementNS(svgNS, 'defs');
                
                // Mask for holes (inner circles = subtract from shape)
                const mask = document.createElementNS(svgNS, 'mask');
                mask.setAttribute('id', `mask-${id}`);
                
                // White background = show everything
                const whiteBg = document.createElementNS(svgNS, 'rect');
                whiteBg.setAttribute('x', '0');
                whiteBg.setAttribute('y', '0');
                whiteBg.setAttribute('width', '100%');
                whiteBg.setAttribute('height', '100%');
                whiteBg.setAttribute('fill', 'white');
                mask.appendChild(whiteBg);
                
                // Add black circles for holes (black = hide in mask)
                for (const [sideName, circleIndex] of Object.entries(piece)) {
                    const circle = this.sides[sideName][circleIndex];
                    if (circle.type === 'inner') {
                        const hole = document.createElementNS(svgNS, 'circle');
                        hole.setAttribute('cx', circle.cx);
                        hole.setAttribute('cy', circle.cy);
                        hole.setAttribute('r', TEMPLATE.radius);
                        hole.setAttribute('fill', 'black');
                        mask.appendChild(hole);
                    }
                }
                
                defs.appendChild(mask);
                svg.appendChild(defs);
                
                // Create clipPath for inner circles
                const clipPath = document.createElementNS(svgNS, 'clipPath');
                clipPath.setAttribute('id', `clip-${id}`);
                const clipRect = document.createElementNS(svgNS, 'rect');
                clipRect.setAttribute('x', '0');
                clipRect.setAttribute('y', '0');
                clipRect.setAttribute('width', this.square.width);
                clipRect.setAttribute('height', this.square.height);
                clipPath.appendChild(clipRect);
                defs.appendChild(clipPath);
                
                // Main piece group
                const group = document.createElementNS(svgNS, 'g');
                
                // Base square with mask for holes
                const square = document.createElementNS(svgNS, 'rect');
                square.setAttribute('x', '0');
                square.setAttribute('y', '0');
                square.setAttribute('width', this.square.width);
                square.setAttribute('height', this.square.height);
                square.setAttribute('fill', color);
                square.setAttribute('mask', `url(#mask-${id})`);
                group.appendChild(square);
                
                // Add knobs (outer circles) - union operations
                for (const [sideName, circleIndex] of Object.entries(piece)) {
                    const circle = this.sides[sideName][circleIndex];
                    if (circle.type === 'outer') {
                        const knob = document.createElementNS(svgNS, 'circle');
                        knob.setAttribute('cx', circle.cx);
                        knob.setAttribute('cy', circle.cy);
                        knob.setAttribute('r', TEMPLATE.radius);
                        knob.setAttribute('fill', color);
                        group.appendChild(knob);
                    }
                }
                
                svg.appendChild(group);
                
                return svg;
            }
        }

        const colors = [
            '#1e90ff', '#32cd32', '#ff4500', '#ffd700',
            '#9370db', '#00ced1', '#ff69b4', '#9acd32',
            '#4169e1', '#3cb371', '#dc143c', '#ff8c00',
            '#6a5acd', '#20b2aa', '#ff1493', '#7cfc00',
            '#0000cd', '#2e8b57', '#b22222', '#ffa500',
            '#483d8b', '#008b8b', '#c71585', '#7fff00'
        ];

        const generator = new CleanGenerator();
        let currentPieces = [];

        function generatePieces(count) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            currentPieces = [];
            
            for (let i = 0; i < count; i++) {
                const piece = generator.generatePiece();
                const color = colors[i % colors.length];
                
                const card = document.createElement('div');
                card.className = 'piece-card';
                
                const header = document.createElement('div');
                header.className = 'piece-header';
                header.innerHTML = `<div class="piece-id">Piece ${i + 1}</div>`;
                card.appendChild(header);
                
                const svg = generator.createPieceSVG(piece, i, color);
                svg.className = 'piece-svg';
                card.appendChild(svg);
                
                grid.appendChild(card);
                currentPieces.push({ id: i, piece, color });
            }
        }

        function exportGrid() {
            const svgNS = 'http://www.w3.org/2000/svg';
            const masterSVG = document.createElementNS(svgNS, 'svg');
            masterSVG.setAttribute('xmlns', svgNS);
            masterSVG.setAttribute('width', '1200');
            masterSVG.setAttribute('height', '800');
            masterSVG.setAttribute('viewBox', '0 0 1200 800');
            
            const bg = document.createElementNS(svgNS, 'rect');
            bg.setAttribute('width', '1200');
            bg.setAttribute('height', '800');
            bg.setAttribute('fill', '#111');
            masterSVG.appendChild(bg);
            
            const cols = 4;
            const pieceSize = 1200 / cols * 0.7;
            
            currentPieces.forEach((p, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = col * (1200 / cols) + (1200 / cols) / 2;
                const y = row * (700 / 4) + 100;
                
                const group = document.createElementNS(svgNS, 'g');
                group.setAttribute('transform', `translate(${x}, ${y}) scale(0.23)`);
                
                const pieceSVG = generator.createPieceSVG(p.piece, `export-${i}`, p.color);
                pieceSVG.removeAttribute('width');
                pieceSVG.removeAttribute('height');
                pieceSVG.setAttribute('viewBox', '0 0 355.32 355.32');
                
                const cloned = document.importNode(pieceSVG, true);
                group.appendChild(cloned);
                
                masterSVG.appendChild(group);
            });
            
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(masterSVG);
            const blob = new Blob([svgString], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'juzzle-pieces-clean.svg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        generatePieces(16);
    </script>
</body>
</html>
